import requests
import sys
import mysql.connector as mysql

def get_hash(link):
    url_response = requests.get(link)
    url_contents = url_response.text
    return url_contents[198:]


def get_row_count():
    cursor.execute("SELECT * FROM `hashes`")
    c = cursor.fetchall()
    print(sum([1 for i in c]))


def main():
    for i in range(0, 100):

        page_num = (5 - len(str(i))) * "0" + str(i)
        hash = get_hash(f"https://virusshare.com/hashfiles/VirusShare_{page_num}.md5")

        for i in hash.split("\n"):
            sql = """INSERT INTO hashes(hash) VALUES (%s)"""
            cursor.execute(sql, (i,))

            db.commit()

    print(f"----GOT page number {i}/100----")


if __name__ == "__main__":
    db = mysql.connect(
        host="localhost",
        user="root",
        passwd="eladyesh24@gmail.com",
        database="virus_hashes"
    )
    cursor = db.cursor()

    cursor.execute("SET GLOBAL max_allowed_packet=1073741824")
    # cursor.execute("CREATE TABLE hashes (hash VARCHAR(255))")
    # cursor.execute("CREATE DATABASE virus_hashes")
